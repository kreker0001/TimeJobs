{% extends "base.html" %}
{% block title %}
{% if current_user.role == 'moderator' %}
Модерация вакансий — Time Jobs
{% else %}
Мои вакансии и отклики — Time Jobs
{% endif %}
{% endblock %}

{% block content %}
<div class="profile-page">
    <div class="profile-inner">

        <!-- Заголовок страницы -->
        <div class="profile-hero">
            <div class="profile-hero-left">
                <div>
                    <h1 class="text-18-600" style="font-size: 24px;">
                        {% if current_user.role == 'moderator' %}
                        Модерация вакансий
                        {% else %}
                        Мои вакансии и отклики
                        {% endif %}
                    </h1>

                    <p class="profile-text" style="font-size: 13px; color: hsl(var(--twc-grey-400));">
                        {% if current_user.role == 'moderator' %}
                        Просмотр новых вакансий и управление статусами.
                        {% else %}
                        Управление вашими сменами и просмотр откликов.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Нет вакансий -->
        {% if not jobs %}
        <div class="glass-card"
             style="padding: 22px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.06); color: hsl(var(--twc-grey-200));">
            Пока нет вакансий для отображения.
        </div>

        {% else %}

        <!-- Список вакансий -->
        <div style="display: flex; flex-direction: column; gap: 18px; margin-top: 10px;">
            {% for job in jobs %}
            <div class="glass-card"
                 style="padding: 22px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.06);">

                <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 16px;">

                    <!-- Информация о вакансии -->
                    <div>
                        <div class="text-18-600" style="font-size: 18px; margin-bottom: 4px;">
                            {{ job.title }}
                        </div>

                        <div class="profile-text" style="font-size: 14px; color: hsl(var(--twc-grey-400));">
                            {{ job.city or 'Город не указан' }} •
                            {{ job.specialization or 'Специализация не указана' }}
                        </div>

                        <div style="font-size: 12px; color: hsl(var(--twc-grey-500)); margin-top: 4px;">
                            Статус:
                            <span style="
                                {% if job.status == 'approved' %}
                                    color: #4CFA00;
                                {% elif job.status == 'pending' %}
                                    color: #FACC15;
                                {% else %}
                                    color: #A8B3CF;
                                {% endif %}
                            ">
                                {{ job.status }}
                            </span>
                        </div>
                    </div>

                    <!-- Кнопки управления -->
                    <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">

                        {% if current_user.role == 'moderator' %}

                        <form method="post" action="{{ url_for('change_job_status', job_id=job.id, action='approve') }}">
                            <button class="ra-button preset primary" style="padding: 6px 14px; font-size: 12px;">
                                Одобрить
                            </button>
                        </form>

                        <form method="post" action="{{ url_for('change_job_status', job_id=job.id, action='reject') }}">
                            <button class="ra-button preset default"
                                    style="padding: 6px 14px; font-size: 12px; background: rgba(255,0,0,0.2); color: #ff9c9c;">
                                Отклонить
                            </button>
                        </form>

                        {% elif current_user.role == 'employer' %}

                        <form method="post" action="{{ url_for('change_job_status', job_id=job.id, action='close') }}">
                            <button class="ra-button preset default"
                                    style="padding: 6px 14px; font-size: 12px; background: rgba(255,0,0,0.2); color: #ff9c9c;">
                                Закрыть вакансию
                            </button>
                        </form>

                        {% endif %}
                    </div>

                </div>

                <!-- Отклики -->
                {% if current_user.role == 'employer' %}
                <div style="margin-top: 16px; padding-top: 14px; border-top: 1px solid rgba(255,255,255,0.06);">
                    <div class="text-18-600" style="font-size: 14px; margin-bottom: 8px;">Отклики</div>

                    {% if job.applications %}
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        {% for app in job.applications %}
                        <div style="display: flex; justify-content: space-between; padding-bottom: 8px;
                                    border-bottom: 1px solid rgba(255,255,255,0.05);">

                            <div>
                                <div style="font-size: 14px; font-weight: 600; color: white;">
                                    {{ app.worker.name }}
                                </div>

                                <div style="font-size: 12px; color: hsl(var(--twc-grey-400));">
                                    Контакт: {{ app.worker.phone or 'не указан' }}
                                </div>

                                {% if app.note %}
                                <div style="font-size: 12px; color: hsl(var(--twc-grey-300)); margin-top: 4px;">
                                    "{{ app.note }}"
                                </div>
                                {% endif %}
                            </div>

                            <div style="font-size: 12px; color: hsl(var(--twc-grey-500));">
                                {{ app.created_at.strftime('%d.%m.%Y') }}
                            </div>

                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p style="font-size: 12px; color: hsl(var(--twc-grey-500));">
                        Пока нет откликов.
                    </p>
                    {% endif %}
                </div>
                {% endif %}

            </div>
            {% endfor %}
        </div>

        {% endif %}
    </div>
</div>
{% endblock %}
