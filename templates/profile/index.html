{% extends "base.html" %}
{% block title %}Профиль — Time Jobs{% endblock %}

{% block content %}
<section class="bg-dot-pattern-2 profile-page">
    <div class="profile-inner">

        {# ===== HERO: О себе + статистика ===== #}
        <div class="glass-card profile-hero">
            <div class="profile-hero-left">
                <img
                    src="{{ current_user.avatar_url or current_user.avatar or default_avatar(current_user.name) }}"
                    alt="Аватар"
                    class="profile-avatar-img"
                >
                <div>
                    <div class="profile-name">
                        {{ current_user.name }}
                    </div>
                    <div class="profile-role">
                        {% if current_user.role == 'worker' %}
                        Соискатель
                        {% elif current_user.role == 'employer' %}
                        Работодатель
                        {% elif current_user.role == 'moderator' %}
                        Модератор
                        {% else %}
                        Пользователь
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="profile-hero-right">
                <div class="profile-stat-field">
                    <div class="profile-label">Рейтинг</div>
                    <div class="profile-input profile-input--readonly">
                        {% if profile_stats and profile_stats.rating is not none %}
                            {{ '%.1f'|format(profile_stats.rating) }}
                        {% else %}
                            —
                        {% endif %}
                    </div>
                </div>
                <div class="profile-stat-field">
                    <div class="profile-label">
                        {% if current_user.role == 'employer' %}
                            Вакансий
                        {% else %}
                            Откликов
                        {% endif %}
                    </div>
                    <div class="profile-input profile-input--readonly">
                        {{ profile_stats.jobs if profile_stats else 0 }}
                    </div>
                </div>
                <div class="profile-stat-field">
                    <div class="profile-label">
                        {% if current_user.role == 'employer' %}
                            Откликов на вакансии
                        {% else %}
                            Всего действий
                        {% endif %}
                    </div>
                    <div class="profile-input profile-input--readonly">
                        {{ profile_stats.responses if profile_stats else 0 }}
                    </div>
                </div>
            </div>
        </div>

        {# ===== НИЖНЯЯ СЕТКА: левая / правая колонка ===== #}
        <div class="profile-body">
            {# Левая колонка — форма профиля #}
            <div class="glass-card profile-card profile-card--main">
                <h2 class="profile-card__title">Профиль</h2>

                <form method="post" class="profile-form">
                    <div class="profile-form-grid">
                        <div class="profile-field">
                            <label class="profile-label">Телефон</label>
                            <input name="phone"
                                   value="{{ current_user.phone or '' }}"
                                   class="profile-input">
                        </div>

                        <div class="profile-field">
                            <label class="profile-label">Опыт (лет)</label>
                            <input name="exp_years"
                                   type="number"
                                   min="0"
                                   value="{{ current_user.exp_years or 0 }}"
                                   class="profile-input">
                        </div><div class="profile-field profile-field--wide">
                            <label class="profile-label">Образование / о себе</label>
                            <textarea name="education"
                                      rows="4"
                                      class="profile-input profile-input--textarea"
                                      placeholder="Кратко расскажите о себе">{{ current_user.education or '' }}</textarea>
                        </div>
                    </div>

                    {# Страховой взнос — только для соискателя #}
                    {% if current_user.role == 'worker' %}
                    <div class="profile-deposit">
                        <div class="profile-deposit-text">
                            Страховой взнос повышает доверие работодателей и может быть
                            использован в спорных ситуациях.
                        </div>
                        <div class="profile-deposit-field">
                            <label class="profile-label">Страховой взнос, ₽</label>
                            <input name="deposit"
                                   type="number"
                                   min="0"
                                   step="100"
                                   value="{{ current_user.deposit or '' }}"
                                   class="profile-input">
                        </div>
                    </div>
                    {% endif %}

                    <div class="profile-actions">
                        <button class="profile-save-btn">
                            Сохранить
                        </button>
                    </div>
                </form>
            </div>

            {# Правая колонка — без градиентов, как форма #}
            <div class="glass-card profile-card profile-card--side">
				<h2 class="profile-card__title">Аккаунт</h2>

				<div class="profile-side-section">
					<h3 class="profile-side-subtitle">Безопасность</h3>
					<div class="profile-field">
						<label class="profile-label">Почта</label>
						<div class="profile-input profile-input--readonly">
							{{ current_user.email }}
						</div>
					</div>
					<p class="profile-note">
						Смену пароля можно сделать отдельной формой и обработчиком,
						например, на <code>/change_password</code>.
					</p>
				</div>

				{# один общий блок, который уедет вниз #}
				<div class="profile-side-session">
					<h3 class="profile-side-subtitle">Сессия</h3>
					<p class="profile-text">
						Выйдите из аккаунта на этом устройстве.
					</p>
					<a href="{{ url_for('logout') }}" class="profile-logout-btn">
						Выйти
					</a>
				</div>
			</div>
        </div>
    </div>
</section>
{% endblock %}